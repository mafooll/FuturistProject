# предыдущая попытка генерации sql-query завершилась ошибкой

## ИСХОДНЫЙ ЗАПРОС ПОЛЬЗОВАТЕЛЯ

{user_query}

## ИСТОРИЯ ОШИБОК

{error_history}

## ПОСЛЕДНЯЯ ОШИБКА

{last_error}

## ВАЖНО ПРИ ИСПРАВЛЕНИИ

1. **Для вопросов про ПРИРОСТ** ("на сколько выросло", "прирост"):
   - ОБЯЗАТЕЛЬНО используй `video_snapshots` таблицу
   - используй колонки `delta_*` (например, `delta_views_count`)
   - для суммы прироста: `SELECT COALESCE(SUM(delta_views_count), 0) FROM video_snapshots WHERE ...`

2. **Для вопросов про КОЛИЧЕСТВО видео с приростом**:
   - используй `COUNT(DISTINCT video_id)` чтобы не считать одно видео несколько раз
   - добавляй условие `delta_views_count > 0` если нужны только видео с новыми просмотрами

3. **Для дат:**
   - публикация видео: `videos.video_created_at`
   - момент замера (для приростов): `video_snapshots.created_at`
   - ВСЕГДА используй `DATE(...)` для сравнения по дате

4. **Для NULL значений:**
   - ВСЕГДА используй COALESCE с 0 для SUM/COUNT
   - например: `COALESCE(SUM(delta_views_count), 0)`

## ТВОЯ ЗАДАЧА

проанализируй ошибку и исправь sql-query. верни ТОЛЬКО исправленную sql-query в виде чистого текста без md форматирования и без объяснений
